# ❌ ОШИБКА 401: API КЛЮЧ OPENROUTER НЕДЕЙСТВИТЕЛЕН

## Проблема

При попытке использовать ИИ консультант:
```
❌ Все модели недоступны:
❌ Claude 3.5 Sonnet (Latest): 401
❌ Claude 3.5 Sonnet: 401
❌ Llama 3.2 90B Vision: 401
...все модели: 401
```

**Ошибка 401** = Unauthorized (Не авторизован)

## Причины ошибки 401

1. **API ключ истек** — срок действия закончился
2. **API ключ неверный** — был изменен или удален
3. **Нулевой баланс** — закончились кредиты на OpenRouter
4. **Лимиты исчерпаны** — достигнут месячный лимит
5. **Ключ деактивирован** — был удален на сайте

## Ваш текущий ключ

```
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
```

## Что делать

### 1. Проверьте баланс и ключи
Зайдите на: **https://openrouter.ai/keys**

- Проверьте баланс (Credits)
- Проверьте, активен ли ключ
- Проверьте лимиты использования

### 2. Создайте новый API ключ

Если ключ истек или баланс нулевой:

1. Зайдите на https://openrouter.ai/keys
2. Удалите старый ключ (если нужно)
3. Создайте новый ключ
4. Пополните баланс (если нужен)

### 3. Обновите ключ в приложении

После получения нового ключа, обновите его:

#### Вариант A: В файле `config.py`
```python
OPENROUTER_API_KEY = "sk-or-v1-ВАШ_НОВЫЙ_КЛЮЧ"
```

#### Вариант Б: В файле `.streamlit/secrets.toml`
```toml
[api_keys]
OPENROUTER_API_KEY = "sk-or-v1-ВАШ_НОВЫЙ_КЛЮЧ"
```

### 4. Перезапустите приложение

```bash
streamlit run app.py
```

## Альтернативные решения

### Если не хотите использовать OpenRouter

Можно использовать локальную модель через Ollama:

```bash
# Установите Ollama
brew install ollama

# Запустите Ollama
ollama serve

# Скачайте модель
ollama pull llama3.2-vision
```

Затем нужно будет изменить код для работы с Ollama вместо OpenRouter.

## Проверка ключа вручную

```bash
curl -X GET "https://openrouter.ai/api/v1/models" \
  -H "Authorization: Bearer ВАШ_КЛЮЧ"
```

Если вернется 401, ключ точно недействителен.

## Важно

⚠️ **Без действующего API ключа OpenRouter следующие функции НЕ БУДУТ РАБОТАТЬ:**
- ИИ консультант
- Анализ ЭКГ (ИИ интерпретация)
- Анализ рентгена (ИИ заключение)
- Анализ МРТ/КТ/УЗИ
- Генетический анализ (ИИ интерпретация)
- Протокол приёма (ИИ генерация)

**Решение:** Обновите API ключ на действующий!

