Версия 3.29.0 - Исправление извлечения PDF в лабораторном анализе
Дата: 2025-12-26

ИЗМЕНЕНИЯ:
- Исправлена ошибка с pdfjs-dist на сервере (TypeError: Object.defineProperty)
- PDF теперь конвертируется в изображения на клиенте (в браузере)
- Добавлен новый API endpoint /api/analyze/lab-images для обработки PDF страниц
- Добавлен прогресс-бар конвертации PDF
- Убрана зависимость от Gemini Flash для PDF (решает проблему rate limit)

ФАЙЛЫ:
- app/lab/page.tsx - добавлена конвертация PDF на клиенте
- app/api/analyze/lab/route.ts - убрана обработка PDF с сервера
- app/api/analyze/lab-images/route.ts - новый endpoint для PDF страниц

BACKUP:
- backups/lab_page_backup_20251226_175808.tsx
- backups/lab_route_backup_20251226_175808.ts
- backups/lab_images_route_backup_20251226_175808.ts

ТЕХНИЧЕСКИЕ ДЕТАЛИ:
- PDF.js загружается через CDN на клиенте (https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.379)
- Конвертация PDF в изображения происходит в браузере перед отправкой на сервер
- Каждая страница PDF конвертируется в PNG с масштабом 2.0 для лучшего качества
- Максимум обрабатывается 7 страниц PDF
- Изображения отправляются на сервер через новый endpoint /api/analyze/lab-images

РЕШЕННЫЕ ПРОБЛЕМЫ:
- Ошибка "TypeError: Object.defineProperty called on non-object" при загрузке PDF
- Ошибка "429 - rate-limited upstream" при использовании Gemini Flash для PDF
- Не работало извлечение данных из PDF файлов в лабораторном анализе

