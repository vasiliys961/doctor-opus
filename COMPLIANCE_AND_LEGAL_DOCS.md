# Юридическая и техническая документация Doctor Opus v3.50

Этот файл содержит официальные формулировки для контролирующих органов и техническое описание механизмов защиты данных.

---

## 1. Заявка для платежных систем (Prodamus / Robokassa)

**Предмет:** Подключение приема платежей для SaaS-платформы.
**Сайт:** `[v-selivanov.ru или ваш домен]`
**Юридическое лицо:** Самозанятый Селиванов В.Ф. (ИНН 920455053236)

**Текст обоснования:**
«Проект **Doctor Opus** — это узкоспециализированная информационно-аналитическая платформа для врачей (Decision Support System). Система предоставляет облачный доступ к мощностям нейросетевых моделей для автоматизации рутинных процессов: структурирования протоколов осмотра, технической интерпретации лабораторных данных и анализа медицинских изображений.

Система работает по модели **SaaS**. Пользователи приобретают лицензионные пакеты «вычислительных единиц» (юнитов), которые расходуются пропорционально сложности выполняемых операций. 

Проект полностью соответствует законодательству РФ:
1.  **Локализация:** Серверы и базы данных размещены в РФ на мощностях провайдера **Timeweb**.
2.  **Защита данных:** Реализована автоматическая анонимизация данных перед обработкой.
3.  **Статус:** ПО не является медицинским изделием и не оказывает медицинских услуг, выступая интеллектуальным помощником врача.»

---

## 2. Сводка для банков и регуляторов (Росздравнадзор)

**Тип системы:** Информационно‑аналитическая платформа для врачей (SaaS‑сервис). По функционалу близка к СППВР/CDSS, но юридически не является зарегистрированным медицинским изделием.

### Анонимизация и безопасность (152-ФЗ)
*   **Механизм Soft Anonymization:** В приложении реализован алгоритм на базе регулярных выражений (`lib/anonymization.ts`), который в реальном времени сканирует входящий текст и маскирует:
    *   ФИО (русские и латинские).
    *   Даты рождения и полные даты.
    *   Номера документов (Паспорта, СНИЛС, ИНН, Полисы).
    *   Контактные данные (Телефоны, Email, Адреса).
*   **Локальная обработка:** Парсинг тяжелых файлов (DICOM, PDF) происходит в браузере пользователя. На сервер и во внешние ИИ-модели уходят только обезличенные текстовые токены или фрагменты изображений без метаданных пациента.
*   **Stateless-архитектура:** Исходные медицинские файлы не хранятся в постоянной базе данных. Они существуют только в оперативной памяти в момент анализа.

### Юридический статус
*   Программа предоставляет «второе мнение» и формирует **вспомогательный черновик описания**.
*   В интерфейсе и системных инструкциях ИИ (`lib/prompts.ts`) жестко зафиксировано: ИИ запрещено ставить окончательные диагнозы. 
*   Любой результат работы системы требует обязательной проверки и подписи врача. Ответственность за клиническое решение остается за специалистом.

---

## 3. Техническая реализация (Для памяти разработчика)

### Как устроены механизмы защиты и контроля:

1.  **Анонимизация (`lib/anonymization.ts`):**
    *   Используется каскад `Regex` для вырезания PHI (Protected Health Information).
    *   Внедрен список `MEDICAL_EXCEPTIONS` (КТ, МРТ, УЗИ и т.д.), чтобы фильтр не удалял важные медицинские аббревиатуры, принимая их за инициалы.
    *   Функция `anonymizeObject` рекурсивно очищает все данные перед отправкой в OpenRouter API.

2.  **Аудит по отделениям (`lib/subscription-manager.ts`):**
    *   В объект `Transaction` добавлено обязательное поле `specialty`.
    *   При каждом списании баланса (через `deductBalance`) система автоматически подхватывает контекст страницы (например, если врач в разделе ЭКГ — записывается 'cardiology').
    *   Агрегация данных происходит на лету в компоненте `/app/clinic/dashboard/page.tsx` без нагрузки на основную БД.

3.  **Инфраструктурный слой (`lib/database.ts`):**
    *   Подключение к БД реализовано через стандартный драйвер **pg** (node-postgres). Строка подключения задаётся переменной окружения `POSTGRES_URL` или `DATABASE_URL`, что позволяет разворачивать приложение на любом хостинге с PostgreSQL, в том числе **Timeweb**.
    *   Все таблицы (согласия, балансы, фидбек) спроектированы под требования Робокассы и 152-ФЗ.

4.  **Универсальный конструктор (`lib/prompts.ts`):**
    *   Внедрена база из 22 медицинских профилей с жестко заданными структурами JSON и Markdown.
    *   Это гарантирует, что ИИ не «галлюцинирует» структуру документа, а заполняет заранее подготовленные медицинские бланки (зубные формулы, суставной статус и т.д.).
