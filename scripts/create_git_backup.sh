#!/bin/bash
# create_git_backup.sh - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ git commit Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð¾Ð¼

set -e  # ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ

echo "ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ git backup Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð¾Ð¼..."
echo ""

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾ Ð¼Ñ‹ Ð² git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð½Ðµ Ð² git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸"
    echo "ðŸ’¡ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ git: git init"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ
echo "ðŸ“Š ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° git..."
STATUS=$(git status --porcelain)

if [ -z "$STATUS" ]; then
    echo "âœ… Ð Ð°Ð±Ð¾Ñ‡Ð°Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ñ‡Ð¸ÑÑ‚Ð°Ñ"
    CURRENT_COMMIT=$(git rev-parse HEAD)
    echo "ðŸ“Œ Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ commit: $CURRENT_COMMIT"
else
    echo "âš ï¸  ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð½ÐµÐ·Ð°ÐºÐ¾Ð¼Ð¼Ð¸Ñ‡ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:"
    echo "$STATUS"
    echo ""
    read -p "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² commit? (y/n) " -n 1 -r
    echo ""
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "ðŸ“¤ Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²ÑÐµÑ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹..."
        git add -A
    else
        echo "âŒ ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾. Ð—Ð°ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚ÑŒÑ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð¾Ð¼."
        exit 1
    fi
fi

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ commit
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
COMMIT_MSG="Backup before refactoring: $TIMESTAMP

ÐŸÐµÑ€ÐµÐ´ Ð½Ð°Ñ‡Ð°Ð»Ð¾Ð¼ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°:
- Ð ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³ app.py - Ð²Ñ‹Ð½Ð¾Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ† Ð² pages/
- Ð’Ñ‹Ð½Ð¾Ñ Ð¾Ð±Ñ‰ÐµÐ¹ Ð»Ð¾Ð³Ð¸ÐºÐ¸ Ð² utils/
- Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² Ð² app_imports.py
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚ Ð¸Ð· config/constants.py

Ð’Ð°Ð¶Ð½Ð¾:
- Ð”ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹ ÐÐ• ÑƒÐ´Ð°Ð»ÑÐµÐ¼ (ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ ÑÐ²ÑÐ·Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²)
- Ð›Ð¾Ð³Ð¸ÐºÐ° Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸ ÐÐ• Ð¼ÐµÐ½ÑÐµÐ¼ (Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ñ‹ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ð½ÐµÑ‚Ñ€Ð¾Ð½ÑƒÑ‚Ñ‹Ð¼Ð¸)
- Ð’ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð½Ñ‹Ðµ (Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð»Ð¾Ð³Ð¸ÐºÐ¸)

Ð”Ð»Ñ Ð¾Ñ‚ÐºÐ°Ñ‚Ð°: git checkout $TIMESTAMP Ð¸Ð»Ð¸ git checkout before-refactoring-$TIMESTAMP"

echo "ðŸ’¾ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ commit..."
git commit -m "$COMMIT_MSG" || {
    if [ -z "$STATUS" ]; then
        echo "âš ï¸  ÐÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð° (ÑƒÐ¶Ðµ Ð²ÑÐµ Ð·Ð°ÐºÐ¾Ð¼Ð¼Ð¸Ñ‡ÐµÐ½Ð¾)"
        CURRENT_COMMIT=$(git rev-parse HEAD)
    else
        echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ commit"
        exit 1
    fi
}

# ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ commit hash
COMMIT_HASH=$(git rev-parse HEAD)
echo "âœ… Commit ÑÐ¾Ð·Ð´Ð°Ð½: $COMMIT_HASH"

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÐ³ Ð´Ð»Ñ Ð»ÐµÐ³ÐºÐ¾Ð³Ð¾ Ð¾Ñ‚ÐºÐ°Ñ‚Ð°
TAG_NAME="before-refactoring-$TIMESTAMP"
echo "ðŸ·ï¸  Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐ³Ð°: $TAG_NAME"
git tag -a "$TAG_NAME" -m "Backup before refactoring: $TIMESTAMP" || {
    echo "âš ï¸  Ð¢ÐµÐ³ ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð¸Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ"
}

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð² Ñ„Ð°Ð¹Ð»
BACKUP_INFO_FILE="backups/git_backup_info.txt"
mkdir -p backups
cat > "$BACKUP_INFO_FILE" << EOF
# Git Backup Information

**Ð”Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ:** $(date +"%Y-%m-%d %H:%M:%S")
**Commit hash:** $COMMIT_HASH
**Tag:** $TAG_NAME

## ÐŸÐ»Ð°Ð½ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°:

1. Ð ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³ app.py - Ð²Ñ‹Ð½Ð¾Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ† Ð² pages/
2. Ð’Ñ‹Ð½Ð¾Ñ Ð¾Ð±Ñ‰ÐµÐ¹ Ð»Ð¾Ð³Ð¸ÐºÐ¸ Ð² utils/
3. Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² Ð² app_imports.py
4. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚ Ð¸Ð· config/constants.py

## ÐšÐ°Ðº Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒÑÑ:

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: Ð§ÐµÑ€ÐµÐ· Ñ‚ÐµÐ³ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
\`\`\`bash
git checkout $TAG_NAME
\`\`\`

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð§ÐµÑ€ÐµÐ· commit hash
\`\`\`bash
git checkout $COMMIT_HASH
\`\`\`

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 3: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð²ÐµÑ‚ÐºÑƒ Ð¾Ñ‚ backup
\`\`\`bash
git checkout -b restore-backup $TAG_NAME
\`\`\`

## Ð’Ð°Ð¶Ð½Ð¾:

- Ð”ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹ ÐÐ• ÑƒÐ´Ð°Ð»ÑÐµÐ¼ (ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ ÑÐ²ÑÐ·Ð¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²)
- Ð›Ð¾Ð³Ð¸ÐºÐ° Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸ ÐÐ• Ð¼ÐµÐ½ÑÐµÐ¼ (Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ñ‹ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ð½ÐµÑ‚Ñ€Ð¾Ð½ÑƒÑ‚Ñ‹Ð¼Ð¸)
- Ð’ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð½Ñ‹Ðµ (Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð»Ð¾Ð³Ð¸ÐºÐ¸)
EOF

echo "ðŸ“ Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð° Ð²: $BACKUP_INFO_FILE"
echo ""
echo "âœ… Git backup ÑÐ¾Ð·Ð´Ð°Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
echo ""
echo "ðŸ“Œ Commit: $COMMIT_HASH"
echo "ðŸ·ï¸  Tag: $TAG_NAME"
echo ""
echo "ðŸš€ ÐœÐ¾Ð¶Ð½Ð¾ Ð½Ð°Ñ‡Ð¸Ð½Ð°Ñ‚ÑŒ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³!"
echo ""
echo "ðŸ’¡ Ð”Ð»Ñ Ð¾Ñ‚ÐºÐ°Ñ‚Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ:"
echo "   git checkout $TAG_NAME"



