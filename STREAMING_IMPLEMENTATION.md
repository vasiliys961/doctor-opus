# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Streaming (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞)

**–î–∞—Ç–∞:** 2025-12-06  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –≠–ö–ì

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª—å—é (streaming). –¢–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ –º–µ—Ä–µ —Ç–æ–≥–æ, –∫–∞–∫ –º–æ–¥–µ–ª—å –µ–≥–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç, —Å–æ–∑–¥–∞–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç "–ø–µ—á–∞—Ç–∞—é—â–µ–π –º–∞—à–∏–Ω–∫–∏".

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `claude_assistant.py`

1. **–ú–µ—Ç–æ–¥ `send_vision_request_streaming()`**
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç streaming —á–µ—Ä–µ–∑ OpenRouter API
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `"stream": True` –≤ payload
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `requests.post(..., stream=True)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
   - –ü–∞—Ä—Å–∏—Ç Server-Sent Events (SSE) —Ñ–æ—Ä–º–∞—Ç –æ—Ç OpenRouter
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å `st.write_stream()`

2. **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç OpenRouter:**
   - –§–æ—Ä–º–∞—Ç SSE: `data: {...}`
   - –ö–∞–∂–¥—ã–π chunk —Å–æ–¥–µ—Ä–∂–∏—Ç `choices[0].delta.content`
   - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ: `data: [DONE]` –∏–ª–∏ `finish_reason` –≤ chunk

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ chunks:**
   - –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ `response.iter_lines()`
   - –ü–∞—Ä—Å–∏–Ω–≥ JSON –∏–∑ –∫–∞–∂–¥–æ–≥–æ `data: {...}` chunk
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `content` –∏–∑ `delta`
   - Yield –∫–∞–∂–¥–æ–≥–æ chunk –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `app.py`

1. **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `perform_analysis_with_streaming()`**
   - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π streaming
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –ø—Ä–∏ –æ—à–∏–±–∫–µ streaming
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ (Gemini) –∏ —Ç–æ—á–Ω–æ–≥–æ (Opus) –∞–Ω–∞–ª–∏–∑–∞

2. **UI —ç–ª–µ–º–µ–Ω—Ç—ã:**
   - Checkbox "üì∫ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (streaming)" (–≤–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `st.write_stream()` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è streaming —Ç–µ–∫—Å—Ç–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ `st.write()` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streaming:
- ‚úÖ **Opus 4.5** (—Ç–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑) - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç streaming
- ‚ö†Ô∏è **Gemini Flash** (–±—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑) - –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º (–±—ã—Å—Ç—Ä–æ –∏ —Ç–∞–∫)

### –†–∞–∑–¥–µ–ª—ã —Å streaming:
- ‚úÖ **–≠–ö–ì** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
- ‚è≥ **–û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∫–æ–¥–µ:
```python
# Streaming —Ä–µ–∂–∏–º
use_streaming = st.checkbox("üì∫ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (streaming)", value=True)

if use_streaming:
    text_generator = assistant.send_vision_request_streaming(prompt, image_array, metadata)
    result = st.write_stream(text_generator)
else:
    result = assistant.send_vision_request(prompt, image_array, metadata)
    st.write(result)
```

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. –í–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é "üì∫ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (streaming)"
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∞–Ω–∞–ª–∏–∑–∞
3. –¢–µ–∫—Å—Ç –±—É–¥–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ –º–µ—Ä–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **UX —É–ª—É—á—à–µ–Ω–∏–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ä–∞–∑—É
2. **–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏** - –∫–∞–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±—â–µ–µ –≤—Ä–µ–º—è —Ç–æ –∂–µ
3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —á–∏—Ç–∞—Ç—å —Ä–∞–Ω—å—à–µ

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. Gemini Flash –ø–æ–∫–∞ –±–µ–∑ streaming (–Ω–æ –∏ —Ç–∞–∫ –±—ã—Å—Ç—Ä–æ)
2. –¢–æ–∫–µ–Ω—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ (–ø–æ —Å–ª–æ–≤–∞–º)
3. –ü—Ä–∏ –æ—à–∏–±–∫–µ streaming –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å streaming –¥–ª—è Gemini Flash
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å streaming –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä chunks –¥–ª—è –ª—É—á—à–µ–≥–æ UX

